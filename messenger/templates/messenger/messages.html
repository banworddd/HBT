<!-- templates/myapp/messages.html -->
{% extends 'layout.html' %}

{% block title %}Chat Messages{% endblock %}

{% block content %}
    <div class="chat-container">
        <h2>Chat Messages with {{ chat_data.other_user }}</h2>
        {% if chat_data.other_user_status%}
        <p>Онлайн</p>
        {% else %}
        <p>Оффлайн</p>
        {% endif %}
        {% for message in chat_data.messages %}
            <table width="100%">
                <tr>
                    {% if message.author__username == chat_data.current_user %}
                        <td align="right" width="70%">
                            <div style="background-color: #dcf8c6; padding: 10px; border-radius: 10px;">
                                <p>{{ message.text }}</p>
                                {% if message.picture_url %}
                                    <p><img src="{{ message.picture_url }}" width="150"> </p>
                                {% endif %}
                                <p style="font-size: 0.8em; color: #999;">{{ message.send_time|date:"d M Y, H:i" }}</p>
                                <p style="font-size: 0.8em; color: #999;">{{ message.status }}</p>
                                {% if not message.is_deleted %}
                                <p><a href="{% url 'deletemessage' message_id=message.id %}">x</a></p>
                                {% endif %}
                            </div>
                        </td>
                        <td width="30%"></td>
                    {% else %}
                        <td width="30%"></td>
                        <td align="left" width="70%">
                            <div style="background-color: #ffffff; padding: 10px; border-radius: 10px;">
                                <p>{{ message.text }}</p>
                                <p style="font-size: 0.8em; color: #999;">{{ message.send_time|date:"d M Y, H:i" }}</p>
                                {% if message.picture_url %}
                                    <p><img src="{{ message.picture_url }}" width="150"> </p>
                                {% endif %}
                                {% if not message.is_deleted %}
                                <p><a href="{% url 'deletemessage' message_id=message.id %}">x</a></p>
                                {% endif %}
                            </div>
                        </td>
                    {% endif %}
                </tr>
            </table>
        {% empty %}
            <p>No messages in this chat.</p>
        {% endfor %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Отправить</button>
        </form>
    </div>
{% endblock %}
